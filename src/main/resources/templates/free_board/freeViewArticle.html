<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="/layout/layout">
<head>
<meta charset="UTF-8">
<title>글 상세 보기 페이지</title>
<style type="text/css">
	#tr_button_modify{
		display: none;
		
	}
</style>
<script src="https://code.jquery.com/jquery-latest.min.js"></script>
<script>
	//제이쿼리 업로드할 이미지 미리보기 함수
	function readImage(input){	// 매개변수 input this >> input의 객체 정보 (파일)
		if(input.files && input.files[0]){
			let reader = new FileReader();
			reader.onload = function(event){
				console.log(event);
				$('#preview').attr('src',event.target.result);
			}
			reader.readAsDataURL(input.files[0]);
		}else{	// 사진이 선택되지 않았을 때 미리보기 제거
			$('#preview').attr('src','#');
		}
	}
	//글 수정( 인풋태그 활성화 ) 함수
	function fn_free_enable(obj) {
		document.getElementById("tr_button_modify").style.display="block";
		document.getElementById("tr_button").style.display="none";
		document.getElementById("id_title").disabled=false;
		document.getElementById("id_content").disabled=false;
		let imgName = document.getElementById("id_imgFile");
		if(imgName != null){
			imgName.disabled=false;
		}
	}
	//수정 반영하기
	function fn_free_modify_article(obj) {
		obj.action = "/board/freeModArticle.do";
		obj.submit();
	}
	//수정 취소하기(취소 누르면 글 상세보기 페이지로 돌아감)
	function free_toList(obj) {
		obj.action = "/board/freeViewArticle.do";	//  articleNo 변수에 ${article.articleNo} 값 담아서 돌아가게 함
		obj.method= "get";
		obj.submit();
	}
	//글 삭제하기
	function fn_free_remove_article(url,articleNo) {
		//동적으로 form태그 생성 (필요없는 정보를 가진 form을 이용하지 않고 필요한 정보만 servlet으로 보내는 form 생성하기 위함)
		let del_form =document.createElement("form");
		del_form.setAttribute("action",url);
		del_form.setAttribute("method","post");
		let articleNoInput = document.createElement("input");	//동적으로 input태그 생성
		articleNoInput.setAttribute("type","hidden");
		articleNoInput.setAttribute("name","articleNo");
		articleNoInput.setAttribute("value",articleNo);	// 받은 매개변수(글 번호)를 서블릿으로 보내게 함
		del_form.appendChild(articleNoInput);
		document.body.appendChild(del_form);
		del_form.submit();
	}
	//리스트로 돌아가기(글 목록 페이지 이동 메서드)
	function free_backToList(obj) {
		obj.method= "get";
		obj.action = "/board/freeListArticles.do";
		obj.submit();
	}
</script>
</head>
<body>
	<th:block layout:fragment="content">
		<form name="frmArticle" action="" method="post" enctype="multipart/form-data">
			<table align="center">
				<tr>
					<td width="150" align="center" bgcolor="#ff9933">글번호</td>
					<td> <input type="text" th:value="${article.articleNo}" disabled> 
					<input type="hidden" name="articleNo" th:value="${article.articleNo}"></td>
				</tr>
				<tr>
					<td width="150" align="center" bgcolor="#ff9933">작성자 아이디</td>
					<td> <input type="text" th:value="${article.id}" disabled> </td>
				</tr>
				<tr>
					<td width="150" align="center" bgcolor="#ff9933">제목</td>
					<td> <input type="text" id="id_title" name="title" th:value="${article.title}" disabled> </td>
				</tr>
				<tr>
					<td width="150" align="center" bgcolor="#ff9933">내용</td>
					<td> <textarea rows="10" cols="50" id="id_content" name="content" th:text="${article.content}" disabled> </textarea> </td>	<!-- textarea태그는 input태그와 달리 value가 아닌 태그 사이에 값을 넣음 -->
				</tr>
					<tr th:if="${not #strings.isEmpty(article.imageFileName)}">
						<td width="150" align="center" bgcolor="ff9933" rowspan="2">이미지</td>
						<td> <input type="hidden" name = originalFileName th:value="${article.imageFileName}"> 
						<img id = "preview" th:src="@{/download.do(articleNo=${article.articleNo},imageFileName=${article.imageFileName})}" width="200"></td>
					</tr>
					<tr>
						<td> <input type="file" id="id_imgFile" name="imageFileName" onchange="readImage(this)" disabled> </td>
					</tr>
				<tr th:if="${not #strings.isEmpty(article.imageFileName)}">
					<td width="150" align="center" bgcolor="ff9933">등록일자</td>
					<td> <input type="text" th:value="${article.writeDate}" disabled> </td>
				</tr>
				<!-- 수정 버튼 누를시 나타나는 버튼 -->
				<tr id="tr_button_modify">
					<td  align="center" colspan="2"> 
					<input type="button" value="수정반영" onclick="fn_free_modify_article(this.form)">
					<input type="button" value="수정취소" onclick="free_toList(this.form)">
					</td> 
				</tr>
				<!-- 글 상세보기 페이지 하단에 나오게 되는 버튼 -->
				<tr id = "tr_button">
					<td align="center" colspan="2">
						<span th:if="${article.id == session.member.id}">
							<input type="button" value="수정하기" onclick="fn_free_enable(this.form)">
							<input type="button" value="삭제하기" th:onclick="|fn_free_remove_article('/board/freeRemoveArticle.do',${article.articleNo})|">
						</span>
						<input type="button" value="리스트로 돌아가기" onclick="free_backToList(this.form)">
					</td>
				</tr>
			</table>
		</form>
	</th:block>
</body>
</html>